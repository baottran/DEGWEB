<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<div class="show-make-form">
  <div class="container">
  <%= render partial: 'nav_pills', locals: {current: "queue"} %>
  <h2>Inquiry Details</h2>
  <br>
  <div class="panel panel-default">
    <div class="panel-heading">Submission Information</div>
    <div class="panel-body submission-content" id="status-text">
      <div class="inquiry-item">
        <strong>Tracking #: </strong><%= @inquiry.id %>
      </div>
      <div class="inquiry-item">
        <strong>Date Submitted: </strong><%= @inquiry.created_at.in_time_zone('Eastern Time (US & Canada)').strftime("%m/%d/%Y %l:%M%p EDT")     %>
      </div>
      <div class="inquiry-item">
        <strong>Status: </strong><%= @inquiry.status %>
      </div>
    <% if logged_in? %>
      <div class="inquiry-item">
        <strong> Show on Web: </strong><%= @inquiry.show_on_web %>
      </div>
    <% end %>
    </div>
  </div>

  <% if logged_in? %>
  <div class="panel panel-primary">
    <div class="panel-heading">Admin Actions</div>
    <div class="panel-body admin-actions">
      <% if @inquiry.status === "Received by DEG" %>
        <a href="/inquiries/<%= @inquiry.id %>/email_ip" class="btn btn-success btn-lg">Submit to IP</a>
        <a href="/inquiries/<%= @inquiry.id %>/rslve_no_chng" class="btn btn-default btn-lg disabled">Resolve (No IP Change)</a>
        <a href="/inquiries/<%= @inquiry.id %>/rslve_ip_chng" class="btn btn-default btn-lg disabled">Resolve (IP Change)</a>
      <% elsif @inquiry.status === "Submitted to IP" %>
        <a href="/inquiries/<%= @inquiry.id %>/email_ip" class="btn btn-default btn-lg disabled">Submit to IP</a>
        <a href="/inquiries/<%= @inquiry.id %>/rslve_no_chng" class="btn btn-default btn-lg">Resolve (No IP Change)</a>
        <a href="/inquiries/<%= @inquiry.id %>/rslve_ip_chng" class="btn btn-default btn-lg">Resolve (IP Change)</a>
      <% else %>
        <a href="/inquiries/<%= @inquiry.id %>/email_ip" class="btn btn-default btn-lg disabled">Submit to IP</a>
        <a href="/inquiries/<%= @inquiry.id %>/rslve_no_chng" class="btn btn-success btn-lg">Resolve (No IP Change)</a>
        <a href="/inquiries/<%= @inquiry.id %>/rslve_ip_chng" class="btn btn-success btn-lg">Resolve (IP Change)</a>
      <% end %>
      <%= link_to 'Delete Inquiry', inquiry_path(@inquiry),
                  method: :delete,
                  data: { confirm: 'Are you sure?' } %>
    </div>
  </div>
  <% end %>
<div class="panel panel-primary">
  <div class="panel-heading">Inquiry Resolution</div>
  <div class="panel-body">
    <div id="resolution-form" hidden=true>
      <%= render 'resolution_form' %>
    </div>
    <div id="resolution-text">
      <p><%= @inquiry.resolution %></p>
      <% if logged_in? || params[:ip] === "review" %>
        <% if @inquiry.status != "Resolved (IP Change)" && @inquiry.status != "Resolved (No IP Change)" %>
          <% resolution_btn_title = "Enter Resolution" %>
        <% else %>
          <% resolution_btn_title = "Edit Resolution" %>
        <% end %>
        <button type="submit" class="btn btn-primary btn-submit" id="resolution-edit"><%= resolution_btn_title %></button>
      <% end %>
    </div>
  </div>
</div>

<div class="inquiry-show-form">
  <div class="inquiry-edit-button">
    <% if logged_in? %>
      <button type="submit" class="btn btn-primary btn-submit" id="inquiry-edit">Edit</button>
    <% end %>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">Vehicle Information</div>
    <div class="panel-body submission-content" id="vehicle-info">
      <div class="inquiry-item">
        <strong>Year: </strong><%= @inquiry.year %>
      </div>
      <div class="inquiry-item">
        <strong>Make: </strong><%= @inquiry.make %>
      </div>
      <div class="inquiry-item">
        <strong>Model: </strong><%= @inquiry.model %>
      </div>
      <div class="inquiry-item">
        <strong>Body: </strong><%= @inquiry.body_type %>
      </div>
      <div class="inquiry-item">
        <strong>VIN: </strong><%= @inquiry.vin %>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">Customer Detail</div>
    <div class="panel-body">
      <div class="customer-detail-data">
        <p><strong>Name: </strong><%= @inquiry.name %></p>
        <p><strong>Title: </strong><%= @inquiry.title %></p>
        <p><strong>Shop Name: </strong><%= @inquiry.shop_name %></p>
        <p><strong>Address Line 1: </strong><%= @inquiry.address_1 %></p>
        <p><strong>Address Line 2: </strong><%= @inquiry.address_2 %></p>
        <p><strong>City: </strong><%= @inquiry.city %></p>
        <p><strong>Zip Code: </strong><%= @inquiry.zip_code %></p>
        <p><strong>State: </strong><%= @inquiry.state %></p>
        <p><strong>Phone: </strong><%= @inquiry.phone %></p>
        <p><strong>Fax: </strong><%= @inquiry.fax %></p>
        <p><strong>Email: </strong><%= @inquiry.email %></p>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">Database Inquiry</div>
    <div class="panel-body">
      <div class="inquiry-data">
        <p><strong>Inquiry Type: </strong><%= @inquiry.inquiry_type %></p>
        <p><strong>Client ID:</strong><%= @inquiry.client_id %></p>
        <p><strong>Database: </strong><%= @inquiry.database %></p>
        <% case @inquiry.inquiry_type
          when 'Missing Information' %>
            <p><strong>Area of Vehicle: </strong><%= @inquiry.missing_area_of_vehicle %></p>
            <p><strong>Missing Part Name: </strong><%= @inquiry.missing_part_name %></p>
            <p><strong>Missing Part Description: </strong><%= @inquiry.missing_part_description %></p>
            <p><strong>OEM Part Number: </strong><%= @inquiry.missing_oem_part_number %></p>
            <p><strong>Missing Information: </strong><%= @inquiry.missing_information %></p>
            <p><strong>Issue Summary: </strong><%= @inquiry.missing_issue_summary %></p>
            <p><strong>Suggested Action: </strong><%= @inquiry.missing_suggested_action %></p>
          <% when 'Parts' %>
            <p><strong>Area of Vehicle: </strong><%= @inquiry.parts_area_of_vehicle %></p>
            <p><strong>Part Name: </strong><%= @inquiry.parts_part_name %></p>
            <p><strong>Part Description: </strong><%= @inquiry.parts_part_description %></p>
            <p><strong>OEM Part Number: </strong><%= @inquiry.parts_oem_part_number %></p>
            <p><strong>Issue Summary: </strong><%= @inquiry.parts_issue_summary %></p>
            <p><strong>Suggested Action: </strong><%= @inquiry.parts_suggested_action %></p>
          <% when 'Procedure Page Issue' %>
            <p><strong>Area of Vehicle: </strong><%= @inquiry.procedure_area_of_vehicle %></p>
            <p><strong>Page #: </strong><%= @inquiry.procedure_page_number %></p>
            <p><strong>Issue Summary: </strong><%= @inquiry.procedure_issue_summary %></p>
            <p><strong>Suggested Action: </strong><%= @inquiry.procedure_suggested_action %></p>
          <% when 'Welded Panel Operations' %>
            <p><strong>Area of Vehicle: </strong><%= @inquiry.welded_area_of_vehicle %><%= @inquiry.welded_area_of_vehicle_other_field%></p>
   					<p><strong>Part Name: </strong><%= @inquiry.welded_part_name %></p>
   					<p><strong>Part Number: </strong><%= @inquiry.welded_part_number %></p>
   					<p><strong>Issue Summary: </strong><%= @inquiry.welded_issue_summary %></p>
   					<p><strong>Individual Procedure Steps: </strong><%= @inquiry.welded_procedure_steps %></p>
   					<p><strong>Technician Skill Level: </strong><%= @inquiry.welded_skill_level %></p>
   					<p><strong>Actual Time To Complete: </strong><%= @inquiry.welded_complete_time_hour %> hours <%= @inquiry.welded_complete_time_min %> minutes</p>
   					<p><strong>Suggested Action: </strong><%= @inquiry.welded_suggested_action %></p>
          <% when 'Non-Welded Panel Operations' %>
            <p><strong>Area of Vehicle: </strong><%= @inquiry.non_welded_area_of_vehicle %><%= @inquiry.non_welded_area_of_vehicle_other_field%></p>
   					<p><strong>Part Name: </strong><%= @inquiry.non_welded_part_name %></p>
   					<p><strong>Part Number: </strong><%= @inquiry.non_welded_part_number %></p>
   					<p><strong>Issue Summary: </strong><%= @inquiry.non_welded_issue_summary %></p>
   					<p><strong>Individual Procedure Steps: </strong><%= @inquiry.non_welded_procedure_steps %></p>
   					<p><strong>Technician Skill Level: </strong><%= @inquiry.non_welded_skill_level %></p>
   					<p><strong>Actual Time To Complete: </strong><%= @inquiry.non_welded_complete_time_hour %> hours <%= @inquiry.non_welded_complete_time_min %> minutes</p>
   					<p><strong>Suggested Action: </strong><%= @inquiry.non_welded_suggested_action %></p>
          <% when 'Refinish Operations' %>
            <p><strong>Area of Vehicle: </strong><%= @inquiry.refinished_area_of_vehicle %><%= @inquiry.refinished_area_of_vehicle_other_field%></p>
   					<p><strong>Issue Summary: </strong><%= @inquiry.refinished_issue_summary %></p>
   					<p><strong>Special Labor or Material Considerations: </strong><%= @inquiry.refinished_special_labor %></p>
   					<p><strong>Estimated Part Surface Area: </strong><%= @inquiry.refinished_surface_area %> square inches</p>
   					<p><strong>Suggested Action: </strong><%= @inquiry.refinished_suggested_action %></p>
          <% when 'All Other' %>
            <p><strong>Issue Summary: </strong><%= @inquiry.all_other_issue_summary%></p>
   					<p><strong>Individual Procedure Steps: </strong><%= @inquiry.all_other_procedure_steps %></p>
   					<p><strong>Actual Time To Complete: </strong><%= @inquiry.all_other_complete_time_hour %> hours <%= @inquiry.all_other_complete_time_min %> minutes</p>
   					<p><strong>Suggested Action: </strong><%= @inquiry.all_other_suggested_action %></p>
          <% else %>
            <p>Unknown Inquiry Type</p>
          <% end %>
      </div>
    </div>
  </div>
</div>

<div class="panel panel-success" id="inquiry-edit-form">
  <div class="panel-heading">Edit Inquiry Fields</div>
  <div class="panel-body submission-content">
    <%= render 'form_edit' %>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">Attached Files: </div>
  <div class="panel-body">
    <p>1. <a href="<%= @inquiry.attachment.url %>"><%= @inquiry.attachment_file_name %></a></p>
    <p>2. <a href="<%= @inquiry.attachment2.url %>"><%= @inquiry.attachment2_file_name %></a></p>
    <p>3. <a href="<%= @inquiry.attachment3.url %>"><%= @inquiry.attachment3_file_name %></a></p>
    <p>4. <a href="<%= @inquiry.attachment4.url %>"><%= @inquiry.attachment4_file_name %></a></p>
    <p>5. <a href="<%= @inquiry.attachment5.url %>"><%= @inquiry.attachment5_file_name %></a></p>

  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">Notes </div>
  <div class="panel-body">
    <% @inquiry.comments.each do |comment| %>
      <p>
        <p><%= comment.body %></p><br>
        <b><%= comment.commenter %></b> at <i><%= comment.created_at.strftime("%-m/%-d/%y") %></i>
      </p><br>
    <% end %>
    <hr>
    <%= render 'comments/form' %>
  </div>
</div>

<script>
<% if params[:ip] === "review" %>
      var currentResolution = $("#resolution-text").find("p").text();
      $(".inquiry-resolution").focus();
      $("#resolution-text").toggle();
      $("#resolution-form").toggle();
<% end %>

</script>
<%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>